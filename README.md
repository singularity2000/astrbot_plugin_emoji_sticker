# QQ群贴表情监控插件 (astrbot_plugin_emoji_sticker)

一款为 AstrBot 设计的 QQ 群贴表情（Emoji Like）插件，支持自动贴表情、情感分析贴表情以及贴表情行为监控推送。

## 🌟 功能特性

- **手动贴表情**：回复（引用）一条消息并使用 `贴表情 [数量]` 命令，对被引用的消息贴上表情。
    - 若不填数量，则默认贴 1 个（数量可在配置中自定义）。
- **表情跟随**：当用户消息中包含表情（Face）时，Bot 有概率自动为该消息贴上相同的表情。
- **主动贴表情**：Bot 在群聊中会根据配置概率主动为消息贴表情，增加互动感。
- **智能情感分析**：集成 LLM（大语言模型）情感分析，能够根据消息内容自动选择合适情感的表情（如：开心、难过、生气等）。
- **贴表情行为监控**：
    - **实时检测**：检测是谁在哪个群给哪条消息贴了（或撤回了）什么表情。
    - **日志记录**：在终端以 `[QQ群贴表情监控插件]` 名义输出 info 级别日志，包含最完整的人员和群聊信息。
    - **主动推送**：支持将监控信息转发提醒到指定的会话（群或私聊），支持多种推送规则。
    - **撤回监控**：支持对“取消贴表情”行为的监控，可配置为仅记录日志或同步推送消息。
    - **机器人过滤**：可设置是否监控机器人自身的贴表情行为。
    - **信息定制**：支持配置推送消息中人员和群信息的展示精度（如：仅昵称、仅QQ号、全部显示等）。
    - **监控范围控制**：支持黑名单和白名单模式。
    - **消息折叠**：支持对过长的被贴消息进行折叠处理。

## 🚀 安装方法

1. 在 AstrBot 插件管理中通过仓库地址安装：`https://github.com/Singularity2000/astrbot_plugin_emoji_sticker`
2. 重启 AstrBot。

## ⚙️ 配置说明

插件提供丰富的配置项，你可以在 AstrBot 管理面板中进行调整：

### 1. 基础互动设置
- **表情跟随概率 (`emoji_follow`)**：
  - 当用户的消息中含有表情时，Bot 按此概率自动为该消息贴上相同的表情。
- **对消息贴表情的概率 (`emoji_like_prob`)**：
  - Bot 主动对普通群消息贴表情的概率。建议设低一些（如 0.03）。
- **贴表情的时间间隔 (`emoji_interval`)**：
  - 连续贴多个表情时，每个表情之间的时间间隔（秒）。
- **命令默认贴表情数量 (`default_emoji_num`)**：
  - 使用 `贴表情` 命令且未指定数字时，默认贴出的表情个数。

### 2. 情感分析与策略
- **表情选用策略 (`emoji_select_strategy`)**：
  - `random`：完全随机选择表情。
  - `emotion_llm`：调用大模型分析消息情感，从对应的情感分类中选择表情。
- **判断情感用的LLM提供商 (`judge_provider_id`)**：
  - 策略设为 `emotion_llm` 时生效。
- **情感映射表 (`emotions_mapping`)**：
  - 定义情感关键词及其对应的 QQ 表情 ID。

### 3. 监控与推送设置
- **监控机器人自身 (`monitor_self`)**：
  - 是否监控机器人自己贴表情的行为（默认关闭）。
- **黑名单 (`blacklist`)** / **白名单 (`whitelist`)**：
  - 填入会话 SID（如 `napcat:GroupMessage:12345678`）。
  - 优先级：主动推送列表 > 黑名单 > 白名单。若黑白名单均为空，则监控所有群。
- **监控信息推送设置 (`push_list`)**：
  - 用于指定在哪里主动推送监控信息。格式如下：
    1. `napcat:GroupMessage:12345678`：向群 12345678 推送全局监控范围内的所有信息。
    2. `napcat:FriendMessage:987654`：向私聊用户 987654 推送全局监控范围内的所有信息。
    3. `napcat:GroupMessage:56565656:56565656`：在群 56565656 中推送该群自身的贴表情信息。
    4. `napcat:GroupMessage:78787878:56565656,12345678`：在群 78787878 中推送来自群 56565656 和 12345678 的信息。
- **消息折叠字数阈值 (`msg_fold_threshold`)**：
  - 设置是否折叠过长的消息（正整数）。填 0 或非正整数则不折叠。
- **监控推送设置-贴表情者信息 (`operator_display_mode`)**：
  - 控制推送消息中贴表情者的展示方式（如：仅显示昵称、仅QQ号、全部显示）。
- **监控推送设置-群信息 (`group_display_mode`)**：
  - 控制推送消息中群聊的展示方式。
- **监控推送设置-取消贴表情 (`unmonitor_emoji_like_strategy`)**：
  - 控制取消贴表情时的行为：`关闭监控取消贴表情事件`、`在日志中推送`、`在日志和消息中推送`。

## 📖 使用指南

### 1. 手动贴表情
引用一条消息并发送：
- `贴表情` (按配置的默认数量贴)
- `贴表情 3` (贴 3 个表情)

### 2. 监控示例
当有人贴表情时，推送消息示例：
- **贴表情**：`zhang（张三） (123456) 在 “测试群” (878566) 群中给消息“今天天气好冷啊”贴了一个[表情1]`
- **撤回贴表情**：`zhang（张三） (123456) 在 “测试群” (878566) 群中对消息“今天天气好冷啊”撤回了贴表情[表情1]`
*(注：[表情] 会在 QQ 中以原样显示，以上信息丰富程度取决于配置项设置)*
